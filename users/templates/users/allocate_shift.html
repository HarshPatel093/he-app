{% extends "base.html" %}
{% block content %}

<div class="back-btn-container">
  <button type="button" onclick="window.history.back()" class="back-btn">‚Üê Back</button>
</div>

<div class="form-container">
    <h1 class="section-heading">New Shift Allocation</h1>

    {% if messages %}
      <div class="messages">
        {% for message in messages %}
          {% if "shift" in message.tags %}
            <div class="alert success">{{ message }}</div>
          {% endif %}
        {% endfor %}
      </div>
    {% endif %}

    <form method="post" class="shift-form">
        {% csrf_token %}

        <div class="form-group">
          {{ form.staff.label_tag }}
          {{ form.staff }}
        </div>

        <div class="form-group">
          {{ form.clients.label_tag }}
          {{ form.clients }}
        </div>

        <div class="form-group">
          {{ form.date.label_tag }}
          {{ form.date }}
        </div>

        <div class="form-group">
          {{ form.start_time.label_tag }}
          {{ form.start_time }}
        </div>

        <div class="form-group">
          {{ form.end_time.label_tag }}
          {{ form.end_time }}
        </div>

        <button type="submit" class="btn">Save Shift</button>
    </form>
</div>

<!-- Select2 CSS & JS -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script>
  $(document).ready(function() {
    function updateSelect2Titles() {
      $('#id_staff').next('.select2').find('.select2-selection__rendered[title]')
        .attr('title', 'Dropdown: use arrow keys to navigate and Enter to select');

      $('#id_clients').next('.select2').find('.select2-selection__rendered[title]')
        .attr('title', 'Multi-select: use arrow keys to navigate, Enter to select, and Backspace to remove');
    }

    $('#id_staff').select2({
      placeholder: "Search and select staff",
      width: '100%'
    });

    $('#id_clients').select2({
      placeholder: "Search and select clients",
      width: '100%'
    });

    updateSelect2Titles();

    $('#id_staff, #id_clients').on("select2:open select2:close select2:select", function() {
      updateSelect2Titles();
    });
  });
</script>

<style>
/* Reduce top spacing only for this page */
body main {
    padding-top: 15px !important;   /* instead of 40px from base.html */
}

.form-container {
    max-width: 450px;
    margin: 0 auto;
    margin-top: 10px;
    background: #fff;
    padding: 18px 22px;
    border-radius: 10px;
    box-shadow: 0 3px 8px rgba(0,0,0,0.1);
}
.section-heading {
    text-align: center;
    margin-bottom: 15px;
    font-size: 22px;
    font-weight: 700;
}
.shift-form {
    display: flex;
    flex-direction: column;
    gap: 12px;
}
.form-group label {
    font-weight: 600;
    margin-bottom: 3px;
    font-size: 14px;
    display: block;
}
.form-group select,
.form-group input[type="text"],
.form-group input[type="date"],
.form-group input[type="time"],
.form-group input[type="email"],
.form-group input[type="password"] {
    width: 100%;
    box-sizing: border-box;
    padding: 7px 10px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 14px;
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
}
/* extra padding for date/time icons */
input[type="date"],
input[type="time"] {
    padding-right: 35px;
}
.btn {
    margin-top: 10px;
    padding: 8px 14px;
    background: #0056b3;
    color: #fff;
    border: none;
    border-radius: 6px;
    font-size: 14px;
    cursor: pointer;
    transition: background 0.2s ease;
}
.btn:hover {
    background: #003f8a;
}
.back-btn-container {
    margin-bottom: 10px;
}
.back-btn {
    display: inline-block;
    font-size: 14px;
    padding: 6px 14px;
    background: #0056b3;
    color: #FFFFFF;
    border: none;
    outline: none;
    border-radius: 4px;
    font-weight: 600;
    cursor: pointer;  /* hand pointer */
    transition: background 0.2s ease;
}
.back-btn:hover {
    background: #004494;
}
.back-btn:focus {
    outline: none;
}
.alert.success {
    background: #d4edda;
    color: #155724;
    padding: 8px;
    border-radius: 6px;
    margin-bottom: 10px;
    text-align: center;
}
.select2-container--default .select2-selection--single .select2-selection__placeholder,
.select2-container--default .select2-selection--multiple .select2-selection__placeholder {
    color: #333;
    opacity: 1;
}
</style>
{% if messages %}
<script>
  setTimeout(function() {
    window.location.href = "{% url 'shift_list' %}";
  }, 2000);
</script>
{% endif %}

{% endblock %}