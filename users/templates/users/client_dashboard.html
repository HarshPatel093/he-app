{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Client Dashboard</title>
<style>
    body {
        margin: 0;
        font-family: 'Georgia', serif;
        background-color: #f0f4ff;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        padding-bottom: var(--nav-height);
        overflow: hidden;
    }

    :root {
        --nav-height: 65px;
    }

    .client-chart {
        width: 100%;
        max-width: 800px;
        height: 350px;
        margin: 0 auto;       
        display: flex;
        justify-content: center;
        align-items: center;
    }


    .content {
        text-align: center;
        padding: 20px 10px;
    }

    .content h1 {
        font-size: 4vw;
        font-weight: bold;
        margin-bottom: 30px;
    }

    .content h2 {
        font-size: 1vw; 
        font-style: italic;
        font-weight: bold;
        text-decoration: none;
        margin-top: 0;
    }

    .bottom-nav {
        background-color: #D9D9D9;
        width: 100%;
        height: var(--nav-height);
        display: flex;
        justify-content: space-around;
        align-items: center;
        position: fixed;
        bottom: 0;
        left: 0;
    }

    /* Phones */
    @media (max-width: 600px) {
        .content h1 { font-size: 35px; }
        .content h2 { font-size: 22px; }
        .client-chart { height: 380px; }
    }

    /* Tablets */
    @media (min-width: 601px) and (max-width: 1024px) {
        .content h2 { font-size: 32px; }
        .content p { font-size: 20px; }
        .client-chart { height: 420px; }
    }

    /* Desktops */
    @media (min-width: 1025px) {
        .content h1{ font-size: 40px; margin-bottom: 25px; margin-top: 5px;}
        .content h2 { font-size: 27px; }
        .content p { font-size: 24px; }
        .client-chart{height: 360px; font-size: 24px;}
    }
</style>
</head>
<body>

<main  class="content">
    <h1>Dashboard</h1>
    <h2>Goals Progress</h2>
    <div class="client-chart">
        <canvas id="goalsChart"></canvas>
    </div>
</main>

<div class="bottom-nav">
    <a href="{% url 'client_feedback' %}" aria-label="Feedback">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 150 150" width="40" height="40" fill="black">
            <path d="M147 130.1 L147 129.7 Q147.05 126.5 144.75 123.55 L144.75 123.5 Q142.55 120.65 138.45 118.7 130.65 115.05 119.7 115.05 109.5 115.05 102.1 118.2 107.6 121.1 110.75 125.25 111 125.55 111.2 125.85 113.45 129 114.3 132.3 L145 132.3 Q145.65 132.3 146.15 131.95 146.7 131.55 146.9 130.95 L146.9 130.75 Q147 130.45 147 130.1 M2.25 123.5 L2.25 123.55 Q-0.05 126.5 0 129.7 0 129.8 0 129.9 L0.05 130.55 Q0.1 131.3 0.7 131.85 1.25 132.3 2 132.3 L32.8 132.3 Q33.65 129 36 125.8 36.15 125.55 36.35 125.3 39.4 121.1 45 118.2 37.5 115.05 27.35 115.05 16.35 115.05 8.6 118.7 4.45 120.65 2.25 123.5 M73.55 117.1 Q58.95 117.1 48.65 121.95 43.2 124.5 40.3 128.3 L40.3 128.35 Q37.25 132.3 37.3 136.5 37.3 136.65 37.35 136.8 L37.4 137.65 Q37.45 138.65 38.2 139.35 38.95 140 39.95 140 L107.1 140 Q107.95 140 108.6 139.55 109.35 139 109.6 138.2 L109.6 137.9 Q109.75 137.5 109.75 137.1 L109.75 136.5 Q109.8 132.3 106.8 128.35 L106.8 128.3 Q103.85 124.5 98.4 121.95 88.1 117.1 73.55 117.1 M19.2 90.75 Q15.75 94.1 15.75 98.9 15.75 103.65 19.2 107.05 22.55 110.45 27.35 110.45 32.1 110.45 35.5 107.05 38.9 103.65 38.9 98.9 38.9 94.1 35.5 90.75 32.1 87.35 27.35 87.35 22.55 87.35 19.2 90.75 M88.85 95.7 Q88.85 89.4 84.35 84.9 79.85 80.4 73.55 80.4 67.2 80.4 62.7 84.9 58.2 89.4 58.2 95.7 58.2 102 62.7 106.5 67.2 111 73.55 111 79.85 111 84.35 106.5 88.85 102 88.85 95.7 M111.55 90.75 Q108.1 94.1 108.1 98.9 108.1 103.65 111.55 107.05 114.9 110.45 119.7 110.45 124.45 110.45 127.85 107.05 131.25 103.65 131.25 98.9 131.25 94.1 127.85 90.75 124.45 87.35 119.7 87.35 114.9 87.35 111.55 90.75 M116.25 3.4 Q112.7 0 107.75 0 L40.9 0 Q35.95 0 32.55 3.4 29.05 6.75 29.05 11.8 L29.05 43.7 Q29.05 48.65 32.55 52.1 36 55.65 40.9 55.65 L41.9 55.65 41.85 73.3 Q41.85 76.9 43.5 77.45 45.15 78.05 47.5 75.3 L63.95 55.65 107.75 55.65 Q112.7 55.65 116.2 52.15 119.7 48.6 119.7 43.7 L119.7 11.8 Q119.7 6.95 116.25 3.4 M104.3 15.9 L104.3 22 44.2 22 44.2 15.9 104.3 15.9 M89.8 33.75 L89.8 39.9 44.2 39.9 44.2 33.75 89.8 33.75 Z"/>
        </svg>
    </a>
    <a href="{% url 'client_profile' %}" aria-label="Profile">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="40" height="40" fill="black">
        <path d="M463 448.2C440.9 409.8 399.4 384 
                 352 384H288c-47.4 0-88.9 25.8-111 64.2
                 C212.2 487.4 263.2 512 320 512
                 s107.8-24.7 143-63.8zM64 320
                 c0-141.4 114.6-256 256-256s256 114.6 256 256
                 -114.6 256-256 256S64 461.4 64 320zm256 16
                 c39.8 0 72-32.2 72-72s-32.2-72-72-72
                 -72 32.2-72 72 32.2 72 72 72z"/>
    </svg>
    </a>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
<script>
    const ctx = document.getElementById('goalsChart').getContext('2d');
    const goalsChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: [{% for g in goals %}'{{ g.goal_type.name }}'{% if not forloop.last %}, {% endif %}{% endfor %}],
            datasets: [{
                data: [{% for g in goals %}{{ g.progress }}{% if not forloop.last %}, {% endif %}{% endfor %}],
                backgroundColor: '#FFD700',
                borderRadius: 8,
                barThickness: 'flex',
                maxBarThickness: 100,   
                categoryPercentage: 0.6 
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: { enabled: false },
                datalabels: {
                    color: 'black',
                    font: { weight: 'bold', size: 12 },
                    formatter: (value) => value + '%'
                }
            },
            scales: {
                x: {
                    grid: { display: false },
                    ticks: {
                        font: { weight: 'bold', size: 13.5 },
                        maxRotation: 0,
                        minRotation: 0,
                        callback: function(value, index) {
                            let label = this.getLabelForValue(value);
                            const words = label.split(" ");
                            let lines = [];
                            let currentLine = "";

                            words.forEach(word => {
                                if ((currentLine + " " + word).trim().length <= 12) {
                                    currentLine = (currentLine + " " + word).trim();
                                } else {
                                    lines.push(currentLine);
                                    currentLine = word;
                                }
                            });
                            if (currentLine) lines.push(currentLine);
                            return lines; 
                        }

                    }
                },
                y: {
                    beginAtZero: true,
                    max: 100,
                    ticks: { stepSize: 20 },
                    grid: { color: '#ddd' }
                }
            }
        },
        plugins: [ChartDataLabels]
    });
</script>
</body>
</html>